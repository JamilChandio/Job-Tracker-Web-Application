select * from users
select * from OTP_TL


ALTER TABLE OTP_TL
ALTER COLUMN CREATE_DATE TYPE INTEGER USING otp_code::integer;

ALTER TABLE OTP_TL
ADD COLUMN CREATE_DATE DATE;


ALTER TABLE OTP_TL
ALTER COLUMN create_date SET DEFAULT CURRENT_DATE;

ALTER TABLE OTP_TL
ADD COLUMN max_attempts SMALLINT DEFAULT 3 CHECK (max_attempts >= 0 AND max_attempts <= 9);

CREATE TABLE OTP_TL (
    id BIGSERIAL PRIMARY KEY,

    -- Link OTP to a specific user account
    user_id UUID NOT NULL,

    -- OTP value (numeric or alphanumeric)
    otp_code VARCHAR(10) NOT NULL,

    -- OTP expiry timestamp
    expires_at TIMESTAMP NOT NULL,

    -- When the OTP was created
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- Marks whether OTP has already been used
    is_used BOOLEAN NOT NULL DEFAULT FALSE,

    -- Number of invalid attempts
    attempts INT NOT NULL DEFAULT 0,

    -- Track user device/ip (optional)
    request_ip VARCHAR(50),

    -- Foreign key to users table
    CONSTRAINT fk_user_otp
        FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);

